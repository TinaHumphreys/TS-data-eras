```{r}
#| echo: false
library(dplyr)
library(readr)
library(tidyr)
library(ggstream)
library(ggplot2)

taylor <-
  read_rds(here::here("secret-data", "combined_artist_data.rds")) 

taylor_spotify <-
  taylor |> 
  filter(artist == "Taylor Swift") |> 
  mutate(date = as.Date(date)) |> 
  filter(date > as.Date("2022-05-01"),
         stats.source %in% c("spotify", "youtube", "shazam")) |> 
  pivot_longer(cols = c(followers_total, monthly_listeners_current, video_views_total, subscribers_total, shazams_total)) |> 
  mutate(metric = paste0(stats.source, "_", name)) |> 
  select(date, metric, value) |> 
  group_by(month = lubridate::floor_date(date, "month"),
           metric) |> 
  summarize(mean_value = mean(value, na.rm = TRUE)) |> 
  filter(!is.na(mean_value)) |> 
  group_by(metric) |> 
  mutate(mean_value = mean_value - first(mean_value))

taylor_spotify |> 
  filter(!metric %in% c("youtube_video_views_total")) |> 
  ggplot(aes(x = month, y = mean_value, fill = metric), sorting = "onset") +
  geom_stream() +
  geom_stream_label(aes(label = metric))
```