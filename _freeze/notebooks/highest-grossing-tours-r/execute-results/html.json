{
  "hash": "a47d1e5ce7e2cc0339829111d5cc016a",
  "result": {
    "engine": "knitr",
    "markdown": "---\noutput: html_document\neditor_options: \n  chunk_output_type: console\nexecute:\n  eval: false\n---\n\n\n<details>\n\n<summary>See R code</summary>\n\n::: callout-tip\n## Highest-grossing tours of all time visualization\n\nLet's get started by loading the necessary R packages to clean, scrape, and visualize the data. These packages are the building blocks of our data scraping journey.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To clean data\nlibrary(tidyverse)\nlibrary(janitor)\n\n# To scrape data\nlibrary(rvest)\nlibrary(httr)\nlibrary(polite)\n\n# To visualize data\nlibrary(ggplot2)\nlibrary(showtext)\n\nfont_add_google(\"Abril Fatface\", \"abril-fatface\")\nfont_add_google(\"Lato\", \"lato\")\n\nshowtext::showtext_auto()\n```\n:::\n\n\nNow that we have the necessary libraries loaded, it's time to politely scrape data from Wikipedia and bring it into R. We'll start by specifying the URL of the Wikipedia page we want to extract data from:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <-\n  \"https://en.wikipedia.org/wiki/List_of_highest-grossing_concert_tours\"\n```\n:::\n\n\nNext, we'll use the [\\`polite'](https://cran.r-project.org/web/packages/polite/readme/README.html) package to create a 'bag of words' (bow) representation of the URL. This step helps us make a polite request to the web server for the page's content:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_bow <- polite::bow(url)\nurl_bow\n```\n:::\n\n\nOnce we have our 'bow,' we can use it to scrape the web page. We'll specifically target the tables with the class 'wikitable' on the page:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_html <-\n  polite::scrape(url_bow) |>  # <1>\n  rvest::html_nodes(\"table.wikitable\") |> # <2>\n  rvest::html_table(fill = TRUE) \n```\n:::\n\n\n1.  Scrape the webpage\n2.  Pull out the specific table\n\nFinally, we'll clean up the extracted table (the second table on the page, Top 20 highest-grossing tours of all time) by storing it in the `ind_tab` variable and ensuring that column names are in a consistent format:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_tab <- \n  ind_html[[2]] |> \n  clean_names()\n```\n:::\n\n\nThis code segment efficiently fetches and prepares the data we need from the Wikipedia page. Our next step is to clean it for analysis. In this code snippet, we'll perform some essential data cleaning tasks to make our dataset ready for exploration: transforming the Adjusted Gross in 2022 Dollars, Actual Gross, and Average Gross columns into numeric variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_tab_clean <-\n  ind_tab |>\n  dplyr::mutate(across(\n    c(adjusted_gross_in_2022_dollars,\n      actual_gross,\n      averagegross),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\"))\n  ))\n```\n:::\n\n\nWe want to add Taylor's data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_tab_tay <-\n  ind_tab_clean |> \n  add_row(artist = \"Taylor Swift\",\n          tour_title = \"The Eras Tour (Expected)\",\n          year_s = \"2023-2024\",\n          shows = 146,\n          adjusted_gross_in_2022_dollars = 1400000000,\n          .before = 1)\n```\n:::\n\n\nNow that our data is clean and ready, let's visualize the highest-grossing concert tours of all time (as of 2023) using a bar chart. We'll use the ggplot2 package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind_tab_tay |>\n  slice(1:10) |> \n  mutate(color = case_when(artist == \"Taylor Swift\" ~ \"#D3ABD0\",\n                           .default = \"#903345\")) |>\n  ggplot(aes(x = forcats::fct_reorder(tour_title,\n                             adjusted_gross_in_2022_dollars),\n             y = adjusted_gross_in_2022_dollars)) +\n  geom_col(aes(fill = color),\n           color = \"black\",\n           width = .9) +\n  scale_fill_identity() +\n  labs(title = \"Highest-grossing tours of all time\",\n       subtitle = \"(as of 2023)\") +\n  theme(text = element_text(size = 9,\n                            family = \"lato\"),\n        title = element_text(size = 16,\n                             family = \"abril-fatface\")) +\n  geom_text(aes(y = 12000000, label = tour_title),\n            family = \"lato\",\n            hjust = 0,\n            vjust = 0.5,\n            size = 3,\n            color = \"white\",\n            fontface = \"bold\") +\n  geom_text(aes(y = 12000000,\n                label = ifelse(artist == \"Taylor Swift\", tour_title, \"\")),\n            family = \"lato\",\n            hjust = 0,\n            vjust = 0.5,\n            size = 3,\n            color = \"black\",\n            fontface = \"bold\") +\n  geom_text(aes(\n      label = scales::dollar(\n        adjusted_gross_in_2022_dollars,\n        accuracy = 1,\n        scale = 1e-6,\n        suffix = \"M\")),\n      family = \"lato\",\n      hjust = -0.1,\n      vjust = 0.5,\n      size = 3) +\n  coord_flip() +\n  scale_y_continuous(limits = c(0, 1500000000)) +\n  scale_x_discrete(labels = ind_tab_tay |> slice(1:10) |> arrange(adjusted_gross_in_2022_dollars) |> pull(artist)) +\n  theme(panel.background = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggpattern)\n\ntaylor <- here::here(\"notebooks\", \"tours-images\", \"taylor.jpg\")\nu2 <- here::here(\"notebooks\", \"tours-images\", \"u2.jpg\")\nelton <- here::here(\"notebooks\", \"tours-images\", \"elton.jpg\")\ned <- here::here(\"notebooks\", \"tours-images\", \"ed.jpg\")\nstones <- here::here(\"notebooks\", \"tours-images\", \"stones.jpg\")\ngnr <- here::here(\"notebooks\", \"tours-images\", \"gnr.jpg\")\ncoldplay <- here::here(\"notebooks\", \"tours-images\", \"coldplay.jpg\")\nharry <- here::here(\"notebooks\", \"tours-images\", \"harry.jpg\")\nbeyonce <- here::here(\"notebooks\", \"tours-images\", \"beyonce.jpg\")\n\nind_tab_tay |>\n  slice(1:10) |> \n  ggplot(aes(x = forcats::fct_reorder(tour_title,\n                             adjusted_gross_in_2022_dollars),\n             y = adjusted_gross_in_2022_dollars)) +\n  geom_bar_pattern(aes(x = forcats::fct_reorder(tour_title,\n                             adjusted_gross_in_2022_dollars),\n                       y = adjusted_gross_in_2022_dollars,\n                   pattern_filename = as.factor(artist)),\n                   alpha = 0,\n                   pattern = \"image\",\n                   pattern_type = \"squish\",\n                   stat = \"identity\") +\n  scale_pattern_filename_manual(\n    values = c(`Taylor Swift` = taylor, \n               `Elton John` = elton, \n               `Ed Sheeran` = ed,\n               `U2` = u2,\n               `Coldplay` = coldplay,\n               `Harry Styles` = harry,\n               `Guns N' Roses` = gnr,\n               `Beyonce` = beyonce,\n               `The Rolling Stones` = stones)) +\n  scale_fill_identity() +\n  labs(title = \"Highest-grossing tours of all time\",\n       subtitle = \"(as of 2023)\") +\n  theme(text = element_text(size = 9,\n                            family = \"lato\"),\n        title = element_text(size = 16,\n                             family = \"abril-fatface\")) +\n  geom_text(aes(y = 12000000, label = tour_title),\n            family = \"lato\",\n            hjust = 0,\n            vjust = 0.5,\n            size = 3,\n            color = \"white\",\n            fontface = \"bold\") +\n  geom_text(aes(y = 12000000,\n                label = ifelse(artist == \"Taylor Swift\", tour_title, \"\")),\n            family = \"lato\",\n            hjust = 0,\n            vjust = 0.5,\n            size = 3,\n            color = \"black\",\n            fontface = \"bold\") +\n  geom_text(aes(\n      label = scales::dollar(\n        adjusted_gross_in_2022_dollars,\n        accuracy = 1,\n        scale = 1e-6,\n        suffix = \"M\")),\n      family = \"lato\",\n      hjust = -0.1,\n      vjust = 0.5,\n      size = 3) +\n  coord_flip() +\n  scale_y_continuous(limits = c(0, 1500000000)) +\n  scale_x_discrete(labels = ind_tab_tay |> slice(1:10) |> arrange(adjusted_gross_in_2022_dollars) |> pull(artist)) +\n  theme(panel.background = element_blank(),\n        axis.ticks.x = element_blank(),\n        axis.text.x = element_blank(),\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank())\n```\n:::\n\n:::\n\n</details>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}