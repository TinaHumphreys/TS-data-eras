{
  "hash": "6ee702bcc3b846e83568ef59692b7143",
  "result": {
    "engine": "knitr",
    "markdown": "---\noutput: html_document\n---\n\n\n<details><summary>See R code</summary>\n\n:::{.rcode}\n::::{.rcode-header}\nR Code: Highest Grossing Tours Sankey Chart\n::::\n::::{.rcode-container}\n\nTo create the Highest Grossing Tours Sankey Chart, we first load the packages that we will need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To load and clean data\nlibrary(tidyverse)\n\n# To visualize the data  \nlibrary(ggplot2)\nlibrary(scales)\nlibrary(glue)\nlibrary(ggsankey) # get at https://github.com/davidsjoberg/ggsankey\nlibrary(ggtext)\nlibrary(colorspace)\nlibrary(ggh4x)\n```\n:::\n\n\nBorrowing heavily from [Georgios Karamanis'](https://www.linkedin.com/in/georgios-karamanis-a54926153/) [#TidyTuesday post, where he shared an alluvial bump chart made with {ggsankey} with data from UNHCR, the UN Refugee Agency](https://www.linkedin.com/posts/georgios-karamanis-a54926153_tidytuesday-rstats-dataviz-activity-7101468916958322688-7UxN). The heaviest lift came from [{`ggsankey`}, the R Package for making beautiful sankey, alluvial and sankey bump plots in ggplot2](https://github.com/davidsjoberg/ggsankey)\n\nFirst, we're going to load our data, collected manually from Pollstar reporting over the last 20 years. Artist names need to be cleaned up, and we need to structure our dataset for the Sankey Bump plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrank_concert_tours <- read_csv(\"../data/rank_concert_tours.csv\") |>\n  mutate(\n    artist = case_when(\n      artist == \"Tim McGraw/Faith Hill\"  ~ \"Tim Mcgraw et. al.\",\n      artist == \"Tim McGraw / Faith Hill\"  ~ \"Tim Mcgraw et. al.\",\n      artist == \"Kenny Chesney & Tim Mcgraw\"  ~ \"Tim Mcgraw et. al.\",\n      artist == \"Michael Jackson The Immortal World Tour By Cirque Du Soleil\"  ~ \"Michael Jackson\",\n      artist == \"Bruce Springsteen & The E Street Band\"  ~ \"Bruce Springsteen & the E Street Band\",\n      artist == \"Jay-Z / Beyoncé\"   ~ \"Beyoncé & Jay Z\",\n      artist == \"Beyoncé and Jay Z\" ~ \"Beyoncé & Jay Z\",\n      artist == \"Billy Joel/Elton John\"  ~ \"Billy Joel & Elton John\"  ,\n      artist == \"“Summer Sanitarium Tour”/Metallica\"  ~ \"Metallica\",\n      artist == \"'N Sync\"  ~ \"Nsync\",\n      .default = artist\n    )\n  )\n\nfor (YEAR in unique(rank_concert_tours$year)) {\n  # print(as.character(YEAR))\n  \n  year_tbl <- rank_concert_tours |>\n    filter(year == YEAR)\n  \n  add_tbl <- tibble(\n    year = YEAR,\n    artist = (rank_concert_tours$artist |> unique())[!(rank_concert_tours$artist |> unique() %in% year_tbl$artist)],\n    gross = 1\n  )\n  \n  add_tbl$rank <- 11:(nrow(add_tbl) + 10)\n  \n  year_tbl <- year_tbl |>\n    bind_rows(add_tbl)\n  \n  rank_concert_tours <- year_tbl |>\n    bind_rows(rank_concert_tours |>\n                filter(year != YEAR))\n  \n}\n\nrank_concert_tours <- tibble(rank_concert_tours) |>\n  arrange(year, rank)\n\n# Set artist as factor, set levels\n# This helps the visualization\n\n# artist we want in front\nartist_levels <- c(\n  \"Taylor Swift\",\n  \"Ed Sheeran\",\n  \"The Rolling Stones\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"U2\",\n  \"Elton John\",\n  \"Bad Bunny\"\n)\n\nartist_levels = c(artist_levels,\n                  \n                  # everyone else, sorted alphabeically.\n                  (rank_concert_tours$artist |> unique())[!(rank_concert_tours$artist |> unique() %in% artist_levels)] |> sort())\n\nrank_concert_tours$artist <- factor(x = rank_concert_tours$artist,\n                                    levels = artist_levels)\n```\n:::\n\n\nNow, let's use {ggplot} and {ggsankey} to build this plot.\n\nThe placement of many of the annotations is optimized for the square image output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Update with taylor swift colors, https://www.color-hex.com/color-palette/1029201\n#b9d2b5\t(185,210,181)\nts_pal <- tribble(\n  ~ artist,\n  ~ hex_color,\n  \"Taylor Swift\",\n  \"#823549\",\n  \"Ed Sheeran\",\n  \"#f4cb8d\",\n  \"The Rolling Stones\",\n  \"#1EB3B3\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"#0041CC\",\n  \"U2\",\n  \"#76ad6d\",\n  \"Elton John\",\n  \"#cc86cf\",\n  \"Bad Bunny\",\n  \"#6bddfa\"\n)\n# Old colors\n# ts_pal <- tribble(\n#   ~artist,                                  ~hex_color,\n#   \"Bad Bunny\",                              \"#1EB3B3\",\n#   \"Bruce Springsteen & the E Street Band\",  \"#0041CC\",\n#   \"Ed Sheeran\",                             \"#e17d17\",\n#   \"Elton John\",                             \"#A713CC\",\n#   \"Taylor Swift\",                           \"#CE1126\",\n#   \"The Rolling Stones\",                     \"#877DB8\",\n#   \"U2\",                                     \"#38C754\"\n# )\n# ts_pal <- c(\"#1EB3B3\",\"#0041CC\",\"#e17d17\",\"#A713CC\",\"#CE1126\",\"#877DB8\",\"#38C754\")\n\n# set text and position of major artist and tour annotation.\nannot <- tribble(\n  ~ artist,\n  ~ x,\n  ~ y,\n  ~ total,\n  ~ note,\n  ~ size,\n  \"The Rolling Stones\",\n  2003.5,\n  1100,\n  1216000000,\n  \"between 2013-2023\",\n  4.9,\n  \"Bruce Springsteen & the E Street Band\",\n  2010,\n  1550,\n  268300000,\n  \"in 2016\",\n  4.9,\n  \"U2\",\n  2013,\n  1850,\n  316000000,\n  \"in 2017\",\n  4.9,\n  \"Ed Sheeran\",\n  2017,\n  2200,\n  768200000,\n  \"between 2017-2019\",\n  5,\n  \"Elton John\",\n  2018.5,\n  2500,\n  334400000,\n  \"in 2022\",\n  4.8,\n  \"Bad Bunny\",\n  2018.5,\n  2700,\n  373500000,\n  \"in 2022\",\n  4.8,\n  \"Taylor Swift\",\n  2018.6,\n  3000,\n  2400000000,\n  \"Projected\",\n  5.5\n) |>\n  rowwise() |>\n  mutate(label = glue(\"**{artist}**<br>{scales::dollar(total)} {note}\"))\n\nannot$artist <- factor(x = annot$artist,\n                       levels = artist_levels)\n\nf1 <- \"Lato\"\nf2 <- \"Abril Fatface\"\n\n# Borrowing (stealling liberally) from Georgios Karamanis:\n# exporting manually:\np <- rank_concert_tours |>\n  mutate(\n    fill = artist,\n    fill = ifelse(artist %in% annot$artist, artist, NA),\n    fill = as.factor(fill)\n  ) |>\n  ggplot() +\n  # create Sankey bump plot\n  geom_sankey_bump(\n    aes(\n      x = year,\n      node = artist,\n      fill = fill,\n      value = gross,\n      color = after_scale(colorspace::lighten(fill, 0.4))\n    ),\n    linewidth = 0.3,\n    type = \"alluvial\",\n    space = 0,\n    alpha = 0.9\n  ) +\n  # Labels for top artists\n  ggtext::geom_richtext(\n    data = annot,\n    aes(\n      x = x,\n      y = y,\n      label = label,\n      color = artist,\n      size = size\n    ),\n    vjust = 0,\n    family = f1,\n    fill = NA,\n    label.color = NA\n  ) +\n  # More labels\n  annotate(\n    \"text\",\n    x = 2023.2,\n    y = 900,\n    label = \"Mid-Year\\nTotal\\nfor Other\\nArtists\",\n    family = f1,\n    hjust = 0,\n    vjust = 1,\n    color = \"grey30\"\n  ) +\n  # Title and subtitle\n  annotate(\n    \"text\",\n    x = 2000,\n    y = 3500,\n    label = str_wrap(\"How does Taylor Swift's Eras Tour Compare to Others?\", indent = 0),\n    size = 8,\n    family = f2,\n    fontface = \"bold\",\n    hjust = 0,\n    color = \"#181716\"\n  ) +\n  annotate(\n    \"text\",\n    x = 2000,\n    y = 3370,\n    label = str_wrap(\n      \"This plot shows rankings and revenue from each year's top ten international music tours between 2000 and 2023. Other top tours & artists are highlighted. \",\n      50\n    ),\n    size = 5.5,\n    family = f1,\n    hjust = 0,\n    vjust = 1,\n    color = \"#393433\",\n    lineheight = .9\n  ) +\n  \n  # Scales, coord, theme\n  scale_x_continuous(\n    breaks = seq(2002, 2022, 2),\n    minor_breaks = NULL,\n    guide = \"axis_minor\"\n  ) +\n  scale_y_continuous(\n    labels = unit_format(\n      prefix = \"$\",\n      unit = \"Billion\",\n      scale = 1e-3\n    ),\n    limits = c(0, 3600),\n    breaks = c(1000, 2000),\n    minor_breaks = NULL\n  ) +\n  scale_fill_manual(values = ts_pal$hex_color, na.value = \"grey80\") +\n  scale_color_manual(values = ts_pal$hex_color, na.value = \"grey80\") +\n  scale_size_continuous(range = c(4, 6)) +\n  coord_cartesian(clip = \"off\", expand = FALSE) +\n  labs(caption = \"Source: Pollstar. Projection by CNN & QuestionPro\") +\n  theme_minimal(base_family = f1) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(fill = \"#FFFFFE\", color = NA),\n    axis.title = element_blank(),\n    axis.text = element_text(\n      size = 12,\n      margin = margin(5, 0, 0, 0),\n      family = f1,\n      color = \"#393433\"\n    ),\n    # axis.ticks.x = element_line(color = \"grey70\"),\n    # ggh4x.axis.ticks.length.minor = rel(1),\n    plot.margin = margin(20, 75, 30, 35),\n    plot.caption = element_text(margin = margin(10, 0, 0, 0))\n  )\n\n# p\n\nggsave(\n  filename = \"../images/tswift-v-others-sankey-sqr.png\",\n  plot = p,\n  device = png,\n  path = NULL,\n  scale = 1,\n  width = 10,\n  height = 10,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::\n\n\nRectangle Version, for blog post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nts_pal_fill <- tribble(\n  ~ artist,\n  ~ hex_color,\n  \"Taylor Swift\",\n  \"#823549\",\n  \"Ed Sheeran\",\n  \"#f4cb8d\",\n  \"The Rolling Stones\",\n  \"#1EB3B3\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"#0041CC\",\n  \"U2\",\n  \"#76ad6d\",\n  \"Elton John\",\n  \"#cc86cf\",\n  \"Bad Bunny\",\n  \"#6bddfa\"\n)\n\n# Set color for annotation\nts_pal_annotcolor <- tribble(\n  ~ artist,\n  ~ hex_color,\n  \"Bad Bunny\",\n  \"#6bddfa\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"#0041CC\",\n  \"Ed Sheeran\",\n  \"#f4cb8d\",\n  \"Elton John\",\n  \"#cc86cf\",\n  \"Taylor Swift\",\n  \"#823549\",\n  \"The Rolling Stones\",\n  \"#1EB3B3\",\n  \"U2\",\n  \"#76ad6d\"\n)\n# set text and position of major artist and tour annotation.\nannot <- tribble(\n  ~ artist,\n  ~ x,\n  ~ y,\n  ~ total,\n  ~ note,\n  ~ size,\n  \"The Rolling Stones\",\n  2004.5,\n  1100,\n  1216000000,\n  \"between 2013-2023\",\n  5,\n  \"Bruce Springsteen & the E Street Band\",\n  2010,\n  1550,\n  268300000,\n  \"in 2016\",\n  4.9,\n  \"U2\",\n  2013,\n  1900,\n  316000000,\n  \"in 2017\",\n  4.9,\n  \"Ed Sheeran\",\n  2013.5,\n  2200,\n  768200000,\n  \"between 2017-2019\",\n  5.1,\n  \"Elton John\",\n  2019,\n  2250,\n  334400000,\n  \"in 2022\",\n  4.8,\n  \"Bad Bunny\",\n  2020,\n  2600,\n  373500000,\n  \"in 2022\",\n  4.8,\n  \"Taylor Swift\",\n  2019.5,\n  3150,\n  2400000000,\n  \"Projected\",\n  5.5\n) |> rowwise() |>\n  mutate(label = glue(\"**{artist}**<br>{scales::dollar(total)} {note}\"))\n\nannot_segments <- tribble(\n  ~ y,\n  ~ yend,\n  ~ x,\n  ~ xend,\n  ~ colour,\n  1100,\n  850,\n  2004.5,\n  2005,\n  \"The Rolling Stones\",\n  1680,\n  1500,\n  2013,\n  2015.7,\n  \"Bruce Springsteen & the E Street Band\",\n  2250,\n  2100,\n  2016.8,\n  2018,\n  \"Ed Sheeran\",\n  1950,\n  1800,\n  2015,\n  2016.7,\n  \"U2\",\n  2280,\n  1700,\n  2019.7,\n  2021.7,\n  \"Elton John\",\n  2630,\n  2200,\n  2020.5,\n  2021.9,\n  \"Bad Bunny\",\n  3180,\n  2900,\n  2019.5,\n  2022.8,\n  \"Taylor Swift\",\n)\n\nannot$artist <- factor(x = annot$artist,\n                       levels = artist_levels)\n\nf1 <- \"Lato\"\nf2 <- \"Abril Fatface\"\n\n# exporting manually:\np2 <- rank_concert_tours |>\n  mutate(\n    fill = artist,\n    fill = ifelse(artist %in% annot$artist, artist, NA),\n    fill = as.factor(fill)\n  ) |>\n  ggplot() +\n  # create Sankey bump plot\n  geom_sankey_bump(\n    aes(\n      x = year,\n      node = artist,\n      fill = fill,\n      value = gross,\n      color = after_scale(colorspace::lighten(fill, 0.4))\n    ),\n    linewidth = 0.3,\n    type = \"alluvial\",\n    space = 0,\n    alpha = 0.9\n  ) +\n  # Labels for top artists\n  ggtext::geom_richtext(\n    data = annot,\n    aes(\n      x = x,\n      y = y,\n      label = label,\n      color = artist,\n      size = size\n    ),\n    vjust = 0,\n    family = f1,\n    fill = NA,\n    label.color = NA\n  ) +\n  geom_segment(\n    data = annot_segments,\n    aes(\n      x = x,\n      xend = xend,\n      y =  y,\n      yend =  yend,\n      colour = colour\n    ),\n    size = 1,\n    alpha = 0.9\n  ) +\n  \n  # More labels\n  annotate(\n    \"text\",\n    x = 2023.2,\n    y = 900,\n    label = \"Mid-Year\\nTotal\\nfor Other\\nArtists\",\n    family = f1,\n    hjust = 0,\n    vjust = 1,\n    color = \"grey30\"\n  ) +\n  # Title and subtitle\n  annotate(\n    \"text\",\n    x = 2000,\n    y = 3500,\n    label = str_wrap(\"How does Taylor Swift's Eras Tour Compare to Others?\", indent = 0),\n    size = 8,\n    family = f2,\n    fontface = \"bold\",\n    hjust = 0,\n    color = \"#181716\"\n  ) +\n  annotate(\n    \"text\",\n    x = 2000,\n    y = 3370,\n    label = paste0(\n      str_wrap(\n        \"This plot shows rankings and revenue from each year's top ten international music tours between 2000 and 2023.\",\n        60\n      ),\n      \"\\n\",\n      \"Other top tours & artists are highlighted.\"\n    ),\n    size = 5.5,\n    family = f1,\n    hjust = 0,\n    vjust = 1,\n    color = \"#393433\",\n    lineheight = .9\n  ) +\n  \n  \n  # Scales, coord, theme\n  scale_x_continuous(\n    breaks = seq(2002, 2022, 2),\n    minor_breaks = NULL,\n    guide = \"axis_minor\"\n  ) +\n  scale_y_continuous(\n    labels = unit_format(\n      prefix = \"$\",\n      unit = \"Billion\",\n      scale = 1e-3\n    ),\n    limits = c(0, 3600),\n    breaks = c(1000, 2000),\n    minor_breaks = NULL\n  ) +\n  scale_fill_manual(\n    values = c(\n      \"7\" = \"#6bddfa\",\n      \"4\" = \"#0041CC\",\n      \"2\" = \"#f4cb8d\",\n      \"6\" = \"#cc86cf\",\n      \"1\" = \"#823549\",\n      \"3\" = \"#1EB3B3\",\n      \"5\" = \"#76ad6d\"\n    ),\n    na.value = \"grey80\"\n  ) +\n  scale_color_manual(\n    values = c(\n      \"Bad Bunny\" = \"#6bddfa\",\n      \"Bruce Springsteen & the E Street Band\" = \"#0041CC\",\n      \"Ed Sheeran\" = \"#f4cb8d\",\n      \"Elton John\" = \"#cc86cf\",\n      \"Taylor Swift\" = \"#823549\",\n      \"The Rolling Stones\" = \"#1EB3B3\",\n      \"U2\" = \"#76ad6d\"\n    ),\n    na.value = \"grey80\"\n  ) +\n  scale_size_continuous(range = c(4, 6)) +\n  coord_cartesian(clip = \"off\", expand = FALSE) +\n  labs(caption = \"Source: Pollstar. Projection by CNN & QuestionPro\") +\n  theme_minimal(base_family = f1) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(fill = \"#FFFFFE\", color = NA),\n    axis.title = element_blank(),\n    axis.text = element_text(\n      size = 12,\n      margin = margin(5, 0, 0, 0),\n      family = f1,\n      color = \"#393433\"\n    ),\n    # axis.ticks.x = element_line(color = \"grey70\"),\n    # ggh4x.axis.ticks.length.minor = rel(1),\n    plot.margin = margin(20, 75, 30, 35),\n    plot.caption = element_text(margin = margin(10, 0, 0, 0))\n  )\n\n# p2\n\n\nggsave(\n  filename = \"../images/tswift-v-others-sankey-rect.jpg\",\n  plot = p2,\n  device = jpeg,\n  path = NULL,\n  scale = 1,\n  width = 14,\n  height = 8,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::\n\n\n::::\n:::\n\n</details>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}