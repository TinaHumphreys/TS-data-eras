{
  "hash": "b07acd52cb6e07da07c4c7723a5d4a7f",
  "result": {
    "markdown": "---\ntitle: \"Taylor Swift vs Other Tours\"\nformat: \n  html:\n    fig-width: 10\n    fig-height: 10\neditor: visual\neditor_options: \n  chunk_output_type: console\nexecute:\n  eval: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# data loading and manipulation\nlibrary(tidyverse)\n\n# data visualization  \nlibrary(ggplot2)\nlibrary(scales)\nlibrary(glue)\nlibrary(ggsankey) # get at https://github.com/davidsjoberg/ggsankey\nlibrary(ggtext)\nlibrary(colorspace)\nlibrary(ggh4x)\n```\n:::\n\n\nBorrowing heavily from [Georgios Karamanis'](https://www.linkedin.com/in/georgios-karamanis-a54926153/) [#TidyTuesday post, where he shared an alluvial bump chart made with {ggsankey} with data from UNHCR, the UN Refugee Agency](https://www.linkedin.com/posts/georgios-karamanis-a54926153_tidytuesday-rstats-dataviz-activity-7101468916958322688-7UxN) The heaviest lift came from [{`ggsankey`}, the R Package for making beautiful sankey, alluvial and sankey bump plots in ggplot2](https://github.com/davidsjoberg/ggsankey)\n\nFirst, we're going to load our data, collected manually from Pollstar reporting over the last 20 years. Artist names need to be cleaned up, and we need to structure our dataset for the Sankey Bump plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrank_concert_tours <- read_csv(\"../data/rank_concert_tours.csv\") |> \n  mutate(\n    artist = case_when(\n      artist == \"Tim McGraw/Faith Hill\"  ~ \"Tim Mcgraw et. al.\",\n      artist == \"Tim McGraw / Faith Hill\"  ~ \"Tim Mcgraw et. al.\",     \n      artist == \"Kenny Chesney & Tim Mcgraw\"  ~ \"Tim Mcgraw et. al.\",     \n      artist == \"Michael Jackson The Immortal World Tour By Cirque Du Soleil\"  ~ \"Michael Jackson\",\n      artist == \"Bruce Springsteen & The E Street Band\"  ~ \"Bruce Springsteen & the E Street Band\",\n      artist == \"Jay-Z / Beyoncé\"   ~ \"Beyoncé & Jay Z\",\n      artist == \"Beyoncé and Jay Z\" ~ \"Beyoncé & Jay Z\",\n      artist == \"Billy Joel/Elton John\"  ~ \"Billy Joel & Elton John\"  ,\n      artist == \"“Summer Sanitarium Tour”/Metallica\"  ~ \"Metallica\",\n      artist == \"'N Sync\"  ~ \"Nsync\",\n      .default = artist\n    )\n  )\n\nfor (YEAR in unique(rank_concert_tours$year)){\n  # print(as.character(YEAR))\n  \n  year_tbl <- rank_concert_tours |> \n    filter(year == YEAR)\n  \n  add_tbl <- tibble(\n    year = YEAR,\n    artist = (rank_concert_tours$artist |> unique())[!(rank_concert_tours$artist |> unique() %in% year_tbl$artist)],\n    gross = 1\n  )\n  add_tbl$rank <- 11:(nrow(add_tbl)+10)\n  \n  year_tbl <- year_tbl |> \n    bind_rows(\n      add_tbl\n    )\n  \n  rank_concert_tours <- year_tbl |> \n    bind_rows(\n      rank_concert_tours |> \n        filter(year != YEAR)\n    )\n  \n}\n\nrank_concert_tours <- tibble(rank_concert_tours) |> \n  arrange(year, rank)\n\n# Set artist as factor, set levels\n# This helps the visualization\n\n# artist we want in front\nartist_levels <- c(\n  \"Taylor Swift\",\n  \"Ed Sheeran\",\n  \"The Rolling Stones\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"U2\",\n  \"Elton John\",\n  \"Bad Bunny\"\n)\nartist_levels = c(\n  artist_levels,\n  \n  # everyone else, sorted alphabeically. \n  (rank_concert_tours$artist |> unique())[!(rank_concert_tours$artist |> unique() %in% artist_levels)] |> sort()\n)\n\nrank_concert_tours$artist <- factor(\n  x = rank_concert_tours$artist,\n  levels = artist_levels\n)\n```\n:::\n\n\nNow, let's use `ggplot`, `ggsankey` to build this plot.\n\nThe placement of much of the annotations is optimized for the square image output.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set text and position of major artist and tour annotation. \nannot <- tribble(\n  ~artist, ~x, ~y, ~total, ~note, ~size,\n  \"The Rolling Stones\",2003.5, 1100,1216000000,\"between 2013-2023\",4.9,\n  \"Bruce Springsteen & the E Street Band\",2010,1550,268300000,\"in 2016\",4.9,\n  \"U2\", 2013, 1850, 316000000,\"in 2017\",4.9,\n  \"Ed Sheeran\",2017,2200,768200000,\"between 2017-2019\",5,\n  \"Elton John\",2018.5,2500,334400000,\"in 2022\",4.8,\n  \"Bad Bunny\",2018.5,2700,373500000,\"in 2022\",4.8,\n  \"Taylor Swift\",2018.6, 3000, 2200000000,\"Projected\",5.5\n) |> rowwise() |> \n  mutate(\n    label = glue(\"**{artist}**<br>{scales::dollar(total)} {note}\")\n  )\nartist_levels <- c(\n  \"Taylor Swift\",\n  \"Ed Sheeran\",\n  \"The Rolling Stones\",\n  \"Bruce Springsteen & the E Street Band\",\n  \"U2\",\n  \"Elton John\",\n  \"Bad Bunny\"\n)\nannot$artist <- factor(\n  x = annot$artist,\n  levels = artist_levels\n)\n\nf1 <- \"Lato\"\nf2 <- \"Abril Fatface\"\n\n# exporting manually: \np <- rank_concert_tours |> \n  mutate(\n    fill = artist,\n    fill = ifelse(artist %in% annot$artist, artist, NA)\n  ) |> \n  ggplot( ) +\n  # create Sankey bump plot\n  geom_sankey_bump(\n    aes(\n      x = year, \n      node = artist, \n      fill = fill,\n      value = gross,\n      color = after_scale(colorspace::lighten(fill, 0.4))\n    ), \n    linewidth = 0.3, \n    type = \"alluvial\", \n    space = 0, \n    alpha = 0.9\n  ) +\n  # Labels for top artists\n  ggtext::geom_richtext(\n    data = annot, \n    aes(\n      x = x, \n      y = y, \n      label = label, \n      color = artist,\n      size = size\n    ), \n    vjust = 0, \n    family = f1, \n    fill = NA, \n    label.color = NA) + \n  # More labels\n  annotate(\"text\", x = 2023.2, y = 900, label = \"Mid-Year\\nTotal\\nfor Other\\nArtists\", family = f1, hjust = 0, vjust = 1, color = \"grey30\") +\n  # Title and subtitle\n  annotate(\n    \"text\", x = 2000, y = 3500, \n    label = str_wrap(\"How does Taylor Swift's Eras Tour Compare to Others?\", indent = 0), \n    size = 8, family = f2, fontface = \"bold\", hjust = 0, color = \"#181716\") +\n  annotate(\"text\", x = 2000, y = 3370, label = str_wrap(\"This plot shows rankings and revenue from each year's top ten international music tours between 2000 and 2023. Other top tours & artists are highlighted. \", 50), \n           size = 5.5, family = f1, hjust = 0, vjust = 1, color = \"#393433\",\n           lineheight = .9) +\n  \n  # Scales, coord, theme\n  scale_x_continuous(\n    breaks = seq(2002, 2022, 2),\n    minor_breaks = NULL, \n    guide = \"axis_minor\") +\n  scale_y_continuous(\n    labels = unit_format(\n      prefix = \"$\",\n      unit = \"Billion\", \n      scale = 1e-3),\n    limits = c(0,3600),\n    breaks = c(1000,2000),\n    minor_breaks = NULL\n  ) +\n  scale_fill_manual(\n    values = c(\"#1EB3B3\", \"#0041CC\", \"#e17d17\", \"#A713CC\",\"#CE1126\", \"#877DB8\",\"#38C754\"), na.value = \"grey80\") +\n  scale_color_manual(\n    values = c(\"#1EB3B3\", \"#0041CC\", \"#e17d17\", \"#A713CC\",\"#CE1126\", \"#877DB8\",\"#38C754\"), na.value = \"grey80\") +\n  scale_size_continuous(range = c(4, 6)) +\n  coord_cartesian(clip = \"off\", expand = FALSE) +\n  labs(\n    caption = \"Source: Pollstar. Projection by CNN & QuestionPro\"\n  ) +\n  theme_minimal(\n    base_family = f1\n  ) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(fill = \"#FFFFFE\", color = NA),\n    axis.title = element_blank(),\n    axis.text = element_text(size = 12, margin = margin(5, 0, 0, 0), family = f1, color = \"#393433\"),\n    # axis.ticks.x = element_line(color = \"grey70\"),\n    # ggh4x.axis.ticks.length.minor = rel(1),\n    plot.margin = margin(20, 75, 30, 35),\n    plot.caption = element_text(margin = margin(10, 0, 0, 0))\n  )\n\np\n\nggsave(\n  filename = \"../images/tswift-v-others-sankey-sqr.png\",\n  plot = p,\n  device = png,\n  path = NULL,\n  scale = 1,\n  width = 10,\n  height = 10,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::\n\n\nRectangle Version, for blog post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# set text and position of major artist and tour annotation. \nannot <- tribble(\n  ~artist, ~x, ~y, ~total, ~note, ~size,\n  \"The Rolling Stones\",2004.5, 1100,1216000000,\"between 2013-2023\",5,\n  \"Bruce Springsteen & the E Street Band\",2012,1550,268300000,\"in 2016\",4.9,\n  \"U2\", 2015, 1900, 316000000,\"in 2017\",4.9,\n  \"Ed Sheeran\",2017,2200,768200000,\"between 2017-2019\",5.1,\n  \"Elton John\",2020,2550,334400000,\"in 2022\",4.8,\n  \"Bad Bunny\",2020,2800,373500000,\"in 2022\",4.8,\n  \"Taylor Swift\",2020.5, 3150, 2200000000,\"Projected\",5.5\n) |> rowwise() |> \n  mutate(\n    label = glue(\"**{artist}**<br>{scales::dollar(total)} {note}\")\n  )\n\nf1 <- \"Lato\"\nf2 <- \"Abril Fatface\"\n\n# exporting manually: \np <- rank_concert_tours |> \n  ggplot( ) +\n  # create Sankey bump plot\n  geom_sankey_bump(\n    aes(\n      x = year, \n      node = artist, \n      fill = ifelse(artist %in% annot$artist, artist, NA),\n      value = gross,\n      color = after_scale(colorspace::lighten(fill, 0.4))\n    ), \n    linewidth = 0.3, \n    type = \"alluvial\", \n    space = 0, \n    alpha = 0.9\n  ) +\n  # Labels for top artists\n  ggtext::geom_richtext(\n    data = annot, \n    aes(\n      x = x, \n      y = y, \n      label = label, \n      color = artist,\n      size = size\n    ), \n    vjust = 0, \n    family = f1, \n    fill = NA, \n    label.color = NA) + \n  # More labels\n  annotate(\"text\", x = 2023.2, y = 900, label = \"Mid-Year\\nTotal\\nfor Other\\nArtists\", family = f1, hjust = 0, vjust = 1, color = \"grey30\") +\n  # Title and subtitle\n  annotate(\n    \"text\", x = 2000, y = 3500, \n    label = str_wrap(\"How does Taylor Swift's Eras Tour Compare to Others?\", indent = 0), \n    size = 8, family = f2, fontface = \"bold\", hjust = 0, color = \"#181716\") +\n  annotate(\"text\", x = 2000, y = 3370, label = str_wrap(\"This plot shows rankings and revenue from each year's top ten international music tours between 2000 and 2023. Other top tours & artists are highlighted. \", 66), \n           size = 5.5, family = f1, hjust = 0, vjust = 1, color = \"#393433\",\n           lineheight = .9) +\n  \n  # Scales, coord, theme\n  scale_x_continuous(\n    breaks = seq(2002, 2022, 2),\n    minor_breaks = NULL, \n    guide = \"axis_minor\") +\n  scale_y_continuous(\n    labels = unit_format(\n      prefix = \"$\",\n      unit = \"Billion\", \n      scale = 1e-3),\n    limits = c(0,3600),\n    breaks = c(1000,2000),\n    minor_breaks = NULL\n  ) +\n  scale_fill_manual(\n    values = c(\"#1EB3B3\", \"#0041CC\", \"#e17d17\", \"#A713CC\",\"#CE1126\", \"#877DB8\",\"#38C754\"), na.value = \"grey80\") +\n  scale_color_manual(\n    values = c(\"#1EB3B3\", \"#0041CC\", \"#e17d17\", \"#A713CC\",\"#CE1126\", \"#877DB8\",\"#38C754\"), na.value = \"grey80\") +\n  scale_size_continuous(range = c(4, 6)) +\n  coord_cartesian(clip = \"off\", expand = FALSE) +\n  labs(\n    caption = \"Source: Pollstar. Projection by CNN & QuestionPro\"\n  ) +\n  theme_minimal(\n    base_family = f1\n  ) +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(fill = \"#FFFFFE\", color = NA),\n    axis.title = element_blank(),\n    axis.text = element_text(size = 12, margin = margin(5, 0, 0, 0), family = f1, color = \"#393433\"),\n    # axis.ticks.x = element_line(color = \"grey70\"),\n    # ggh4x.axis.ticks.length.minor = rel(1),\n    plot.margin = margin(20, 75, 30, 35),\n    plot.caption = element_text(margin = margin(10, 500, 0, 0))\n  )\n\n# p\n\nggsave(\n  filename = \"../images/tswift-v-others-sankey-rect.png\",\n  plot = p,\n  device = jpeg,\n  path = NULL,\n  scale = 1,\n  width = 14,\n  height = 8,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}