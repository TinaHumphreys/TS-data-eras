{
  "hash": "20016a130fb0fdd64d301de6478800c6",
  "result": {
    "markdown": "::: {.cell}\n\n```{.r .cell-code}\n# To clean data\nlibrary(tidyverse)\nlibrary(janitor)\n\n# To scrape data\nlibrary(rvest)\nlibrary(httr)\nlibrary(polite)\n\n# To visualize data\nlibrary(ggplot2)\nlibrary(showtext)\nlibrary(treemapify)\nlibrary(cowplot)\n\nfont_add_google(\"Abril Fatface\", \"abril-fatface\")\nfont_add_google(\"Lato\", \"lato\")\n\nshowtext::showtext_auto()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <-\n  \"https://en.wikipedia.org/wiki/List_of_Taylor_Swift_live_performances\"\n\nurl_bow <- polite::bow(url)\nurl_bow\n\nind_html <-\n  polite::scrape(url_bow) |>\n  rvest::html_nodes(\"table.wikitable\") |>\n  rvest::html_table(fill = TRUE) \n\nind_tab <- \n  ind_html[[1]] |> \n  janitor::clean_names() |> \n  dplyr::mutate(across(\n    c(adjusted_gross_in_2023_dollar,\n      gross,\n      attendance),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\")))) |> \n  dplyr::mutate(attendance = case_when(title == \"The Eras Tour\" ~ 10512000,\n                                       .default = attendance),\n                gross = case_when(title == \"The Eras Tour\" ~ 2400000000,\n                                       .default = gross),\n                adjusted_gross_in_2023_dollar = case_when(title == \"The Eras Tour\" ~ 2400000000,\n                                       .default = adjusted_gross_in_2023_dollar),\n                label = paste0(title, \"<br><span style='font-size:30pt'>\", scales::dollar(adjusted_gross_in_2023_dollar), \"</span>\"),\n                image = case_when(title == \"The Eras Tour\" ~ \"<img src='notebooks/logo-images/eras.png'>\",\n                                  title == \"Fearless Tour\" ~ \"<img src='notebooks/logo-images/fearless.png' style='width:30%'>\",\n                                  title == \"The 1989 World Tour\" ~ \"<img src='notebooks/logo-images/1989.png'>\",\n                                  title == \"Reputation Stadium Tour\" ~ \"<img src='notebooks/logo-images/reputation.png'>\",\n                                  title == \"Speak Now World Tour\" ~ \"<img src='notebooks/logo-images/speak_now.jpg'>\",\n                                  title == \"The Red Tour\" ~ \"<img src='notebooks/logo-images/red.jpg'>\")) |>\n  mutate(image = paste0(image, \"<br><span style='font-size:30pt'>\", scales::dollar(adjusted_gross_in_2023_dollar), \"</span>\")) |> \n  mutate(adjusted_gross_in_2023_dollar2 = case_when(title == \"Fearless Tour\" ~ adjusted_gross_in_2023_dollar * 1.5,\n                                                   .default = adjusted_gross_in_2023_dollar))\n\ntreemap <-\n  treemapify(ind_tab, area = \"adjusted_gross_in_2023_dollar\")\n\ntreemap <-\n  left_join(ind_tab, treemap |> select(title, ymax:xmax))\n\ntotal <- sum(ind_tab$adjusted_gross_in_2023_dollar)\n\n# https://github.com/wilkox/treemapify/issues/37\n\ntaylor_treemap <-\n  treemap |>\n  ggplot(\n    aes(\n      area = adjusted_gross_in_2023_dollar2,\n      fill = title,\n      label = paste(title, scales::dollar(adjusted_gross_in_2023_dollar, scale = 1e-9, suffix = \"B\"), sep = \"\\n\"),\n      xmin = xmin,\n      ymin = ymin,\n      xmax = xmax,\n      ymax = ymax\n    )\n  ) +\n  geom_treemap() +\n  # draw_image(here::here(\"notebooks\", \"tours-images\", \"tours.png\"),\n  #            scale = 1.45,\n  #            x = 0,\n  #            y = 0.162) +\n  geom_treemap_text(\n    colour = \"white\",\n    place = \"center\",\n    grow = TRUE,\n    reflow = FALSE,\n    family = \"abril-fatface\"\n  ) +\n  # ggfittext::geom_fit_text(\n  #   label = treemap$image,\n  #   family = \"abril-fatface\",\n  #   color = \"white\",\n  #   place = \"center\",\n  #   grow = FALSE,\n  #   rich = TRUE,\n  #   contrast = TRUE\n  # ) +\n  labs(title = scales::dollar(total, big.mark = \".\", scale = 1e-9, suffix = \"B\"), sep = \"\\n\") +\n  theme_void() +\n  theme(\n    legend.position = \"none\",\n    plot.title = element_text(\n      size = 80,\n      family = \"abril-fatface\",\n      hjust = 0.5,\n      color = \"#1D1E3C\"\n    )\n  ) +\n  scale_fill_manual(values = c(\"#b9d2b5\",\n                               \"#f4cb8d\",\n                               \"#b5e9f6\",\n                               \"#d1b2d2\",\n                               \"#CFCAC6\",\n                               \"#C8AE95\"))\n\nggsave(\n  filename = here::here(\"images\", \"taylor_treemap.png\"),\n  plot = taylor_treemap,\n  device = png,\n  path = NULL,\n  scale = 1,\n  width = 14,\n  height = 8,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}