{
  "hash": "18048811aa505b07460807c32b6bdb6a",
  "result": {
    "markdown": "::: {.cell}\n\n```{.r .cell-code}\n# To clean data\nlibrary(tidyverse)\nlibrary(janitor)\n\n# To scrape data\nlibrary(rvest)\nlibrary(httr)\nlibrary(polite)\n\n# To visualize data\nlibrary(ggplot2)\nlibrary(showtext)\nlibrary(rnaturalearth)\nlibrary(terra)\nlibrary(cowplot)\n\nfont_add_google(\"Abril Fatface\", \"abril-fatface\")\nfont_add_google(\"Lato\", \"lato\")\n\nshowtext::showtext_auto()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_gdp <-\n  \"https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)\"\n\nurl_gdp_bow <- polite::bow(url_gdp)\nurl_gdp_bow\n\ngdp_html <-\n  polite::scrape(url_gdp_bow) |>\n  rvest::html_nodes(\"table.wikitable\") |>\n  rvest::html_table(fill = TRUE) \n\ngdp_tab <-\n  gdp_html[[1]] |>\n  janitor::clean_names() |>\n  slice(-1) |>\n  dplyr::mutate(across(c(imf_1_13,\n                         world_bank_14,\n                         united_nations_15),\n                       ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\")))) |>\n  filter(world_bank_14 < 10000 & world_bank_14 > 4900) |>\n  arrange(desc(world_bank_14))\n\nurl_gdp <-\n  \"https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)\"\n\nurl_gdp_bow <- polite::bow(url_gdp)\nurl_gdp_bow\n\ngdp_html <-\n  polite::scrape(url_gdp_bow) |>\n  rvest::html_nodes(\"table.wikitable\") |>\n  rvest::html_table(fill = TRUE) \n\ngdp_tab <-\n  gdp_html[[1]] |>\n  janitor::clean_names() |>\n  slice(-1) |>\n  dplyr::mutate(across(c(imf_1_13,\n      world_bank_14,\n      united_nations_15),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\"))\n  )) |>\n  filter(world_bank_14 < 10000 & world_bank_14 > 4000) |>\n  arrange(desc(world_bank_14))\n\ncountries <- unique(gdp_tab$country_territory)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfiji <- \n  ne_countries(scale = 10, returnclass = \"sf\", country = \"Fiji\") \n\np_Fiji <-\n  ggplot(fiji) +\n  geom_sf(fill = \"#823549\",\n          color = \"#1D1E3C\") +\n  coord_sf(\n    crs = 3460, # https://epsg.io/3460\n    ) +\n  theme_void() +\n  labs(title = gdp_tab |> filter(country_territory == \"Fiji\") |> pull(country_territory),\n       subtitle = scales::dollar(gdp_tab |> filter(country_territory == \"Fiji\") |> pull(world_bank_14), big.mark = \".\", scale = 1e-3, suffix = \"B\")) +\n    theme(\n      plot.subtitle = element_text(size = 12,\n                                   margin = margin(5.5, 0, 8.5, 0, unit = \"pt\"), \n                                   family = \"lato\",\n                                   hjust = 0.5),\n      plot.title = element_text(hjust = 0.5,\n                                margin = margin(24, 0, 5.5, 0, unit = \"pt\"), ),\n      title = element_text(size = 16,\n                           family = \"abril-fatface\",\n                           margin = margin(24, 0, 5.5, 0, unit = \"pt\"))\n    )\n\ncountries <- c(\"Kosovo\", \"Somalia\", \"Togo\", \"Bermuda\", \"Montenegro\", \"Barbados\", \"Eswatini\")\n\ncolors <- c(\"#b9d2b5\", \"#f4cb8d\", \"#d1b2d2\", \"#CFCAC6\", \"#C8AE95\", \"#b5e9f6\", \"#F9B2D0\")\n  \ncountry_plots <- function(country, fill){\n  country_data <-\n    ne_countries(scale = 10, returnclass = \"sf\", country = country)\n\n  p <- ggplot(country_data) +\n    geom_sf(fill = fill,\n            color = \"#1D1E3C\") +\n    coord_sf() +\n    theme_void() +\n    labs(\n      title = gdp_tab |> filter(country_territory == country) |> pull(country_territory),\n      subtitle = scales::dollar(\n        gdp_tab |> filter(country_territory == country) |> pull(world_bank_14), big.mark = \".\", scale = 1e-3, suffix = \"B\"\n      )\n    ) +\n    theme(\n      plot.subtitle = element_text(size = 12,\n                                   family = \"lato\",\n                                   margin = margin(5.5, 0, 8.5, 0, unit = \"pt\"), \n                                   hjust = 0.5),\n      plot.title = element_text(hjust = 0.5,\n                                lineheight = 6.5,\n                                margin = margin(24, 0, 5.5, 0, unit = \"pt\")),\n      title = element_text(size = 16,\n                           margin = margin(24, 0, 5.5, 0, unit = \"pt\"), \n                           family = \"abril-fatface\")\n    )\n  \nplot_name <- paste(\"p_\", country, sep = \"\")\n  assign(plot_name, p, envir = .GlobalEnv)\n\n}\n\npurrr::map2(.f = country_plots, .x = countries, .y = colors)\n\n# One specifically for Taylor Swift\n\np_blank <-\n  ggplot() +\n  labs(title = \"Taylor Swift\",\n       subtitle = \"$6.30B\") +\n  theme_void() +\n  theme(\n    plot.subtitle = element_text(margin = margin(5.5, 0, 5.5, 0, unit = \"pt\"), \n                                 size = 12,\n                                 family = \"lato\",\n                                 hjust = 0.5),\n    plot.title = element_text(hjust = 0.5,\n                              margin = margin(18, 0, 5.5, 0, unit = \"pt\")),\n    title = element_text(margin = margin(18, 0, 5.5, 0, unit = \"pt\"), \n                         size = 24,\n                         family = \"abril-fatface\",\n                         hjust = 1,\n                         color = \"#823549\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngdp_plot <-\n  plot_grid(\n    p_Kosovo,\n    p_Somalia,\n    p_Togo,\n    p_Bermuda,\n    p_blank,\n    p_Montenegro,\n    p_Barbados,\n    p_Fiji,\n    p_Eswatini,\n    align = \"v\"\n  ) +\n  draw_image(\n    here::here(\"notebooks\", \"t_swift.png\"),\n    x = 0.4,\n    y = 0.28,\n    width = 0.2,\n    height = 0.2\n  ) +\n  draw_label(\n    \"The GDP of Taylor\",\n    x = 0.5,\n    y = 1.08,\n    hjust = 0.5,\n    vjust = 1,\n    fontfamily = \"abril-fatface\",\n    size = 32,\n    color = \"#1D1E3C\"\n  ) +\n  theme(# add margin on the left of the drawing canvas,\n    # so title is aligned with left edge of first plot\n    plot.margin = margin(50, 0, 0, 0))\n\nggsave(\n  filename = here::here(\"images\", \"gdp_plot.png\"),\n  plot = gdp_plot,\n  device = png,\n  path = NULL,\n  scale = 1,\n  width = 14,\n  height = 8,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = NULL\n)\n```\n:::",
    "supporting": [
      "gdp-comparison-plot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}