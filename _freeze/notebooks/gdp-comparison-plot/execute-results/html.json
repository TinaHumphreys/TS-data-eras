{
  "hash": "edc45e6608d558560d343d5298d09b63",
  "result": {
    "engine": "knitr",
    "markdown": "---\noutput: html_document\n---\n\n\n<details><summary>See R code</summary>\n\n:::{.rcode}\n::::{.rcode-header}\nR Code: The GDP of Taylor Data Visualization\n::::\n::::{.rcode-container}\n\nFirst, we load the packages that we will need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To clean data\nlibrary(tidyverse)\nlibrary(janitor)\n\n# To scrape data\nlibrary(rvest)\nlibrary(httr)\nlibrary(polite)\n\n# To visualize data\nlibrary(ggplot2)\nlibrary(showtext)\nlibrary(rnaturalearth)\nlibrary(cowplot)\n\nfont_add_google(\"Abril Fatface\", \"abril-fatface\")\nfont_add_google(\"Lato\", \"lato\")\n\nshowtext::showtext_auto()\n```\n:::\n\n\nThe code below retrieves GDP data from a Wikipedia page, processes it, and filters countries based on their World Bank GDP values. It begins by defining the Wikipedia page's URL and politely scraping the page using {polite}. The HTML content is then extracted and specific tables with the class \"wikitable\" are selected and converted into a data frame. This data frame, named `gdp_tab`, undergoes several cleaning steps, including renaming columns, converting certain columns to numeric format, and filtering rows based on World Bank GDP criteria. The resulting data is sorted in descending order of World Bank GDP. Finally, a list of unique countries meeting the specified criteria is stored in the variable countries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_gdp <-\n  \"https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)\"\n\nurl_gdp_bow <- polite::bow(url_gdp)\nurl_gdp_bow\n\ngdp_html <-\n  scrape(url_gdp_bow) |>\n  html_nodes(\"table.wikitable\") |>\n  html_table(fill = TRUE)\n\ngdp_tab <-\n  gdp_html[[1]] |>\n  clean_names() |>\n  slice(-1) |>\n  mutate(across(\n    c(imf_1_13,\n      world_bank_14,\n      united_nations_15),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\"))\n  )) |>\n  filter(world_bank_14 < 10000 & world_bank_14 > 4900) |>\n  arrange(desc(world_bank_14))\n\nurl_gdp <-\n  \"https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)\"\n\nurl_gdp_bow <- polite::bow(url_gdp)\nurl_gdp_bow\n\ngdp_html <-\n  scrape(url_gdp_bow) |>\n  html_nodes(\"table.wikitable\") |>\n  html_table(fill = TRUE)\n\ngdp_tab <-\n  gdp_html[[1]] |>\n  janitor::clean_names() |>\n  slice(-1) |>\n  mutate(across(\n    c(imf_1_13,\n      world_bank_14\n      united_nations_15),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\"))\n  )) |>\n  filter(world_bank_14 < 10000 & world_bank_14 > 4000) |>\n  arrange(desc(world_bank_14))\n\ncountries <- unique(gdp_tab$country_territory)\n```\n:::\n\n\nBelow, we create geographic plots for Fiji and several other countries, with custom styling and GDP-related information displayed on each plot. The countries vector contains a list of countries, and corresponding fill colors are specified in the colors vector. The `country_plots` function is defined to generate individual plots for each country. The `purrr::map2` function applies the `country_plots` function to each country in the countries vector with matching fill colors. Additionally, a separate plot (`p_blank`) is created specifically for Taylor Swift, featuring a custom title and subtitle displaying her estimated wealth.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfiji <-\n  ne_countries(scale = 10,\n               returnclass = \"sf\",\n               country = \"Fiji\")\n\np_Fiji <-\n  ggplot(fiji) +\n  geom_sf(fill = \"#823549\",\n          color = \"#1D1E3C\") +\n  coord_sf(crs = 3460) +\n  theme_void() +\n  labs(\n    subtitle = gdp_tab |> filter(country_territory == \"Fiji\") |> pull(country_territory),\n    title = scales::dollar(\n      gdp_tab |>\n        filter(country_territory == \"Fiji\") |>\n        pull(world_bank_14),\n      big.mark = \".\",\n      scale = 1e-3,\n      suffix = \"B\"\n    )\n  ) +\n  theme(\n    plot.subtitle = element_text(\n      size = 20,\n      margin = margin(10, 0, 8.5, 0, unit = \"pt\"),\n      family = \"lato\",\n      hjust = 0.5\n    ),\n    plot.title = element_text(hjust = 0.5,\n                              margin = margin(50, 0, 5.5, 0, unit = \"pt\")),\n    title = element_text(\n      size = 20,\n      family = \"abril-fatface\",\n      margin = margin(36, 0, 5.5, 0, unit = \"pt\")\n    )\n  )\n\ncountries <-\n  c(\"Kosovo\",\n    \"Somalia\",\n    \"Togo\",\n    \"Bermuda\",\n    \"Montenegro\",\n    \"Barbados\",\n    \"Eswatini\")\n\ncolors <-\n  c(\"#b9d2b5\",\n    \"#f4cb8d\",\n    \"#d1b2d2\",\n    \"#CFCAC6\",\n    \"#C8AE95\",\n    \"#b5e9f6\",\n    \"#F9B2D0\")\n\ncountry_plots <- function(country, fill) {\n  country_data <-\n    rnaturalearth::ne_countries(scale = 10,\n                                returnclass = \"sf\",\n                                country = country)\n  \n  p <- ggplot(country_data) +\n    geom_sf(fill = fill,\n            color = \"#1D1E3C\") +\n    coord_sf() +\n    theme_void() +\n    labs(\n      subtitle = gdp_tab |> filter(country_territory == country) |>\n        pull(country_territory),\n      title = scales::dollar(\n        gdp_tab |> filter(country_territory == country) |> pull(world_bank_14),\n        big.mark = \".\",\n        scale = 1e-3,\n        suffix = \"B\"\n      )\n    ) +\n    theme(\n      plot.subtitle = element_text(\n        size = 20,\n        family = \"lato\",\n        margin = margin(10, 0, 8.5, 0, unit = \"pt\"),\n        hjust = 0.5\n      ),\n      plot.title = element_text(\n        hjust = 0.5,\n        lineheight = 6.5,\n        margin = margin(50, 0, 5.5, 0, unit = \"pt\")\n      ),\n      title = element_text(\n        size = 20,\n        margin = margin(50, 0, 5.5, 0, unit = \"pt\"),\n        family = \"abril-fatface\"\n      )\n    )\n  \n  plot_name <- paste0(\"p_\", country)\n  assign(plot_name, p, envir = .GlobalEnv)\n  \n}\n\nmap2(.f = country_plots, .x = countries, .y = colors)\n\n# One specifically for Taylor Swift\n\np_blank <-\n  ggplot() +\n  labs(subtitle = \"Taylor Swift\",\n       title = \"$6.30B\") +\n  theme_void() +\n  theme(\n    plot.subtitle = element_text(\n      margin = margin(10, 0, 5.5, 0, unit = \"pt\"),\n      size = 26,\n      family = \"lato\",\n      hjust = 0.5\n    ),\n    plot.title = element_text(hjust = 0.5,\n                              margin = margin(50, 0, 10, 0, unit = \"pt\")),\n    title = element_text(\n      margin = margin(50, 0, 15, 0, unit = \"pt\"),\n      size = 28,\n      family = \"abril-fatface\",\n      hjust = 1,\n      color = \"#823549\"\n    )\n  )\n```\n:::\n\n\nNext, we generate a composite plot (`gdp_plot`) using the plot_grid function from the {cowplot} package. The plot grid includes individual country plots for Kosovo, Somalia, Togo, Bermuda, a custom plot for Taylor Swift (`p_blank`), Montenegro, Barbados, Fiji, and Eswatini. The align parameter is set to \"v,\" aligning the plots vertically. Additionally, the code incorporates an image of Taylor Swift (`gdp-taylor.png`) using the draw_image function, positioning it at specific coordinates within the plot. A label is added with the text \"The GDP of Taylor\" using `draw_label`, adjusting its position, font family, size, and color. The overall theme of the plot is modified with a margin adjustment using the theme function. The resulting `gdp_plot` combines individual country plots with a custom element representing Taylor Swift's GDP.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngdp_plot <-\n  plot_grid(\n    p_Kosovo,\n    p_Somalia,\n    p_Togo,\n    p_Bermuda,\n    p_blank,\n    p_Montenegro,\n    p_Barbados,\n    p_Fiji,\n    p_Eswatini,\n    align = \"v\"\n  ) +\n  draw_image(\n    here::here(\"images\", \"gdp-taylor.png\"),\n    x = 0.4,\n    y = 0.32,\n    width = 0.2,\n    height = 0.2\n  ) +\n  draw_label(\n    \"The GDP of Taylor\",\n    x = 0.5,\n    y = 1.05,\n    hjust = 0.5,\n    vjust = 1,\n    fontfamily = \"abril-fatface\",\n    size = 60,\n    color = \"#1D1E3C\"\n  ) +\n  theme(plot.margin = margin(80, 0, 0, 0))\n```\n:::\n\n\nThe ggsave function from the ggplot2 package saves the composite plot (`gdp_plot`) as a PNG image. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggsave(\n  filename = here::here(\"images\", \"gdp_plot.png\"),\n  plot = gdp_plot,\n  device = png,\n  path = NULL,\n  width = 14,\n  height = 14,\n  units = \"in\",\n  dpi = 300,\n  limitsize = TRUE,\n  bg = \"white\"\n)\n```\n:::\n\n\n::::\n:::\n\n</details>",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}