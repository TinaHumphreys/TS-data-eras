{
  "hash": "c47c9908a129b0df019c32ac9dd34222",
  "result": {
    "engine": "knitr",
    "markdown": "---\noutput: html_document\n---\n\n\n<details><summary>See R code</summary>\n\n:::{.rcode}\n::::{.rcode-header}\nR Code: Highest Grossing Tours by Decade Charts\n::::\n::::{.rcode-container}\n\nTo create the Highest Grossing Tours by Decade charts, we first load the packages that we will need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\nlibrary(janitor)\n\n# To scrape data\nlibrary(rvest)\nlibrary(httr)\nlibrary(polite)\n\n# To visualize data\nlibrary(ggplot2)\nlibrary(ggpattern)\nlibrary(showtext)\n\nfont_add_google(\"Abril Fatface\", \"abril-fatface\")\nfont_add_google(\"Lato\", \"lato\")\n\nshowtext::showtext_auto()\n```\n:::\n\n\nOur goal is to compile and organize data about annual highest-grossing concert tours from multiple tables on a Wikipedia page. Below, we extract information about the highest-grossing concert tours from the page. The code starts by defining the URL of the page and scrapes the HTML content using the polite package. Specific tables with the class \"wikitable\" are selected and converted into a data frame (`ind_html`).\n\nThe code focuses on the ninth table (`ind_html[[9]]`) containing information about annual highest-grossing concert tours. There's a function combine_data defined to concatenate multiple tables (from indices 4 to 8 in the `ind_html` list) into a single tibble (`combined_data()`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <-\n  \"https://en.wikipedia.org/wiki/List_of_highest-grossing_concert_tours\"\n\nurl_bow <- bow(url)\nurl_bow\n\nind_html <-\n  scrape(url_bow) |>\n  html_nodes(\"table.wikitable\") |>\n  html_table(fill = TRUE)\n\nannual_hi_gross_tours <-\n  ind_html[[9]] |>\n  janitor::clean_names()\n\ncombine_data <- function(ind_html_list) {\n  combined_data <- tibble::tibble()\n  \n  for (i in 4:8) {\n    extracted_data <- ind_html_list[[i]] |> janitor::clean_names()\n    combined_data <- bind_rows(combined_data, extracted_data)\n  }\n  \n  return(combined_data)\n  \n}\n\nannual_hi_gross_tours <- combine_data(ind_html)\n```\n:::\n\n\nNow we want to clean up the data on annual highest-grossing concert tours, organizing it by decade. A `decade` column is created by rounding down the `year` to the nearest decade using the `floor_date()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntours_by_decade <-\n  annual_hi_gross_tours |>\n  dplyr::mutate(across(\n    c(adjusted_gross_in_2022_dollar,\n      averagegross,\n      actual_gross),\n    ~ as.numeric(str_replace_all(.x, \"[$,]\", \"\"))\n  )) |>\n  mutate(\n    start_year = str_sub(year_s, start = 1, end = 4),\n    year = lubridate::ymd(start_year, truncated = 2L)\n  ) |>\n  mutate(\n    decade = paste0(stringr::str_sub(\n      as.factor(floor_date(year, years(10))), start = 1, end = 4\n    ), \"s\"),\n    tour_title = case_when(\n      tour_title == \"The Eras Tour †\" ~ \"The Eras Tour\",\n      tour_title == \"Music of the Spheres World Tour †\" ~ \"Music of the Spheres World Tour\",\n      tour_title == \"After Hours til Dawn Tour †\" ~ \"After Hours til Dawn Tour\",\n      tour_title == \"Summer Carnival †\" ~ \"Summer Carnival\",\n      tour_title == \"Global Stadium Tour\" ~ \"Global Stadium\",\n      .default = tour_title\n    ),\n    adjusted_gross_in_2022_dollar = case_when(\n      artist == \"Taylor Swift\" &\n        tour_title == \"The Eras Tour\" ~ 2400000000,\n      .default = adjusted_gross_in_2022_dollar\n    ),\n    title = paste0(artist, \" - \", tour_title)\n  )\n```\n:::\n\n\nWe create a function to generate bar plots based on the decade:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngenerate_bar_plot <- function(tours_data, decade) {\n  plot_data <- tours_data |>\n    ggplot(aes(\n      x = fct_reorder(title, adjusted_gross_in_2022_dollar),\n      y = adjusted_gross_in_2022_dollar,\n    )) +\n    geom_col_pattern(\n      aes(pattern_filename = fct_reorder(image, rank)),\n      pattern = \"image\",\n      alpha = 0.8,\n      pattern_type = \"expand\"\n    ) +\n    scale_pattern_filename_discrete(choices = tours_data$image) +\n    scale_x_discrete(\n      labels = function(x)\n        str_wrap(x, width = 20)\n    ) +\n    labs(\n      title = paste(\"Top 10 highest-grossing tours of the\", decade),\n      caption = \"Source: Wikipedia\"\n    ) +\n    theme_minimal() +\n    theme(\n      axis.title.x = element_blank(),\n      axis.title.y = element_blank(),\n      axis.text.x = element_blank(),\n      legend.position = \"none\",\n      title = element_text(\n        size = 26,\n        family = \"abril-fatface\",\n        hjust = 0.5,\n        color = \"#1D1E3C\"\n      ),\n      plot.margin = unit(c(0, 0, 0, 0.15), \"inches\")\n    ) +\n    coord_flip() +\n    geom_text(aes(label = paste0(\n      round(adjusted_gross_in_2022_dollar / 1e6, 0), \"M\"\n    ),\n    hjust = -0.1), size = 8) +\n    ylim(0, 2600000000) +\n    theme(\n      plot.margin = margin(20, 0, 0, 20),\n      plot.caption = element_text(size = 14,\n                                  family = \"lato\"),\n      axis.text = element_text(size = 12)\n    )\n  \n  ggsave(\n    filename = here::here(\"images\", paste0(\"bar_\", decade, \".png\")),\n    plot = plot_data,\n    device = png,\n    path = NULL,\n    width = 14,\n    height = 8,\n    units = \"in\",\n    dpi = 300,\n    limitsize = TRUE,\n    bg = \"white\"\n  )\n}\n```\n:::\n\n\nWe need to associate each artist with an image. Then, we can run the data through the function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntours_1990s <-\n  tours_by_decade |>\n  filter(decade == \"1990s\") |>\n  mutate(\n    image = case_when(\n      artist == \"Celine Dion\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"02dion.jpg\"),\n      artist == \"Eagles\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"04eagles.jpg\"),\n      artist == \"Garth Brooks\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"01brooks.jpg\"),\n      artist == \"Michael Jackson\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"05michael.jpg\"),\n      artist == \"Pink Floyd\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"09pf.jpg\"),\n      artist == \"The Rolling Stones\" &\n        tour_title == \"Bridges to Babylon Tour\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"08stones_babylon.jpg\"),\n      artist == \"The Rolling Stones\" &\n        tour_title == \"Voodoo Lounge Tour\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"10stones_voodoo.jpg\"),\n      artist == \"Tina Turner\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"03tina.jpg\"),\n      artist == \"U2\" &\n        tour_title == \"PopMart Tour\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"07u2_pop.jpg\"),\n      artist == \"U2\" &\n        tour_title == \"Zoo TV Tour\" ~ here::here(\"images\", \"tours-images\", \"1990s\", \"06u2_zoo.jpg\")\n    )\n  )\n\ngenerate_bar_plot(tours_1990s, \"1990s\")\n```\n:::\n\n\nWe do the same for the 2000s, 2010s, and 2020s.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntours_2000s <-\n  tours_by_decade |>\n  filter(decade == \"2000s\") |>\n  mutate(\n    image = case_when(\n      title == \"The Rolling Stones - A Bigger Bang Tour\" ~ \"images/tours-images/2000s/stones_bang.jpg\",\n      title == \"Madonna - Sticky & Sweet Tour\" ~ \"images/tours-images/2000s/madonna.jpg\",\n      title == \"U2 - Vertigo Tour\" ~ \"images/tours-images/2000s/u2_vertigo.jpg\",\n      title == \"The Police - The Police Reunion Tour\" ~ \"images/tours-images/2000s/police.jpg\",\n      title == \"U2 - U2 360° Tour\" ~ \"images/tours-images/2000s/u2_360.jpg\",\n      title == \"The Rolling Stones - Licks Tour\" ~ \"images/tours-images/2000s/stones_lick.jpg\",\n      title == \"Celine Dion - Taking Chances World Tour\" ~ \"images/tours-images/2000s/dion.jpg\",\n      title == \"Cher - Living Proof: The Farewell Tour\" ~ \"images/tours-images/2000s/cher.jpg\",\n      title == \"AC/DC - Black Ice World Tour\" ~ \"images/tours-images/2000s/acdc.jpg\",\n      title == \"Bruce Springsteen and the E Street Band - Magic Tour\" ~ \"images/tours-images/2000s/bruce.jpg\"\n    )\n  )\n\ntours_2010s <-\n  tours_by_decade |>\n  filter(decade == \"2010s\") |>\n  mutate(\n    image = case_when(\n      title == \"Bruno Mars - 24K Magic World Tour\" ~ \"images/tours-images/2010s/bruno.jpg\",\n      title == \"Coldplay - A Head Full of Dreams Tour\" ~ \"images/tours-images/2010s/coldplay.jpg\",\n      title == \"The Rolling Stones - No Filter Tour\" ~ \"images/tours-images/2010s/stones.jpg\",\n      title == \"Ed Sheeran - ÷ Tour\" ~ \"images/tours-images/2010s/ed.jpg\",\n      title == \"Guns N' Roses - Not in This Lifetime... Tour\" ~ \"images/tours-images/2010s/gnr.jpg\",\n      title == \"Metallica - WorldWired Tour\" ~ \"images/tours-images/2010s/metallica.jpg\",\n      title == \"Pink - Beautiful Trauma World Tour\" ~ \"images/tours-images/2010s/pink.jpg\",\n      title == \"Roger Waters - The Wall\" ~ \"images/tours-images/2010s/waters.jpg\",\n      title == \"U2 - The Joshua Tree Tours 2017 and 2019\" ~ \"images/tours-images/2010s/u2_josh.jpg\",\n      title == \"U2 - U2 360° Tour\" ~ \"images/tours-images/2010s/u2_360.jpg\"\n    )\n  )\n\ntours_2020s <-\n  tours_by_decade |>\n  filter(decade == \"2020s\") |>\n  mutate(\n    image = case_when(\n      artist == \"Beyoncé\" ~ \"images/tours-images/2020s/beyonce.jpg\",\n      artist == \"Harry Styles\" ~ \"images/tours-images/2020s/harry.jpg\",\n      artist == \"Coldplay\" ~ \"images/tours-images/2020s/coldplay.jpg\",\n      artist == \"Ed Sheeran\" ~ \"images/tours-images/2020s/ed.jpg\",\n      artist == \"Elton John\" ~ \"images/tours-images/2020s/elton.jpg\",\n      artist == \"Bad Bunny\" ~ \"images/tours-images/2020s/bunny.jpg\",\n      artist == \"Pink\" ~ \"images/tours-images/2020s/pink.jpg\",\n      artist == \"Red Hot Chili Peppers\" ~ \"images/tours-images/2020s/rhcp.jpg\",\n      artist == \"The Weeknd\" ~ \"images/tours-images/2020s/wknd.jpg\",\n      artist == \"Taylor Swift\" ~ \"images/tours-images/2020s/taylor.jpg\"\n    )\n  )\n\ngenerate_bar_plot(tours_2000s, \"2000s\")\ngenerate_bar_plot(tours_2010s, \"2010s\")\ngenerate_bar_plot(tours_2020s, \"2020s\")\n```\n:::\n\n\n::::\n:::\n\n</details>\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}